<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <!-- Meta tags for character set and responsive design -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Bootstrap CSS for styling -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" th:href="@{/css/complaint-details.css}">

        <title>Srinivasa Refrigeration Works - Complaint Details</title>
    </head>
    <body>
        <!-- Heading indicating the complaint details page -->
        <h3>Complaint Details</h3>

        <form th:action="@{/SRW/complaint/search}" th:object="${complaintIdentifierDTO}" method="POST">

            <!-- Helper message providing guidance for input -->
            <p class="helper-message">
                Enter complaint ID or phone number. Add date if using phone number to fetch details.
            </p>

            <!-- Identifier input field with error handling -->
            <label for="identifier">Identifier:</label>
            <input id="identifier" type="text" th:field="*{identifier}" placeholder="Enter complaint id or">
            <span th:if="${#fields.hasErrors('identifier')}" th:errors="*{identifier}" class="error"></span> <br><br>

            <!-- Registered date input field with error handling -->
            <label for="registeredDate">Registered Date:</label>
            <input id="registeredDate" type="date" th:field="*{registeredDate}">
            <span th:if="${#fields.hasErrors('registeredDate')}" th:errors="*{registeredDate}" class="error"></span> <br><br>

            <!-- Button to submit the form for fetching complaint details -->
            <input type="submit" class="btn btn-primary btn-sm mb-3" value="Fetch Complaint"> <br><br>
        </form>

        <!-- Display a message if no complaint is found with given identifier -->
        <p th:if="${noComplaintFound}" class="error" th:text="${noComplaintFound}"></p>

        <!-- Display the complaint details if complaint with identifier exist -->
        <div th:if="${complaint}">
            <p>
                <!-- Unique identifier for the complaint -->
                <span class="bold"> Complaint Id: </span> <span th:text="${complaint.complaintId}"></span> <br>

                <!-- User's name -->
                <span class="bold"> User Name: </span> <span th:text="${complaint.customerName}"></span> <br>

                <!-- User's contact number -->
                <span class="bold"> Phone Number: </span> <span th:text="${complaint.contactNumber}"></span> <br>

                <!-- User's email address -->
                <span class="bold"> Email: </span> <span th:text="${complaint.email != null ? complaint.email : 'Not Provided'}"></span> <br>

                <!-- User's residential address -->
                <span class="bold"> Address: </span> <span th:text="${complaint.address}"></span> <br>

                <!-- Product type -->
                <span class="bold"> Product Type: </span> <span th:text="${complaint.productType}"></span> <br>

                <!-- Product Brand -->
                <span class="bold"> Product Brand: </span> <span th:text="${complaint.brand}"></span> <br>

                <!-- Product Model -->
                <span class="bold"> Product Model: </span> <span th:text="${complaint.productModel}"></span> <br>

                <!-- Complaint issue -->
                <span class="bold"> Issue: </span> <span th:text="${complaint.description}"></span> <br>

                <!-- Complaint creation date -->
                <span class="bold"> Creation Date: </span> <span th:text="${complaint.createdAt}"></span> <br>

                <!-- Complaint status -->
                <span class="bold"> Status: </span> <span th:text="${complaint.status}"></span> <br>

                <!-- Complaint last updated date -->
                <span class="bold"> Last Updated: </span> <span th:text="${complaint.updatedAt != null ? complaint.updatedAt : 'Not Updated Yet'}"></span> <br>

                <!-- Complaint assigned to -->
                <span class="bold"> Assigned To: </span> <span th:text="${complaint.technicianId != null ? complaint.technicianId : 'Awaiting Technician'}"></span> <br>

                <!-- Complaint closure date -->
                <span class="bold"> Closure Date: </span> <span th:text="${complaint.closedAt != null ? complaint.closedAt : 'Not Closed Yet'}"></span> <br>

                <!-- User feedback -->
                <span class="bold"> Feedback: </span> <span th:text="${complaint.customerFeedback != null ? complaint.customerFeedback : 'No Feedback'}"></span> <br>

                <!-- Complaint state -->
                <span class="bold"> State: </span> <span th:text="${complaint.state}"></span> <br>
            </p>
        </div>

        <!-- Button to navigate back to the home page -->
        <a th:href="@{/SRW/home}" class="btn btn-primary btn-sm mb-3">Back to Home</a>

        <!-- Check if user has the role 'OWNER' to display management portal -->
        <div sec:authorize="hasRole('OWNER')">
            <!-- Button to navigate to management portal -->
            <a th:href="@{/SRW/management-portal}" class="btn btn-secondary btn-sm mb-3" title="management portal">Back to Management Portal</a>
        </div>
    </body>
</html>